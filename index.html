<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾åºŠæ–‡ä»¶æµè§ˆå™¨</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --accent-color: #4a90e2;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            max-width: 1200px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        .btn {
            padding: 8px 16px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .breadcrumb {
            font-size: 16px;
            color: #aaa;
        }
        .breadcrumb span {
            color: white;
            font-weight: bold;
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* é€šç”¨å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }

        /* æ–‡ä»¶å¤¹å¡ç‰‡ç‰¹æœ‰æ ·å¼ */
        .card.folder-card {
            border: 1px solid #444;
            align-items: center;
            justify-content: center;
            padding: 30px 10px;
        }
        .folder-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        /* å›¾ç‰‡å®¹å™¨ */
        .img-container {
            width: 100%;
            aspect-ratio: 1 / 1; /* æ­£æ–¹å½¢è£å‰ª */
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s;
        }

        /* æ–‡ä»¶å */
        .filename {
            padding: 10px;
            font-size: 12px;
            color: #ccc;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            box-sizing: border-box;
        }

        /* åŠ è½½ä¸é”™è¯¯æç¤º */
        .status-msg {
            text-align: center;
            margin-top: 50px;
            font-size: 16px;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>

    <div class="header">
        <button id="backBtn" class="btn" onclick="goBack()" disabled>â¬… è¿”å›ä¸Šä¸€çº§</button>
        <div class="breadcrumb" id="breadcrumb">å½“å‰è·¯å¾„: /</div>
    </div>

    <div id="gallery" class="gallery">
        <div class="status-msg">æ­£åœ¨åˆå§‹åŒ–...</div>
    </div>

    <script>
        // ================= é…ç½®åŒºåŸŸ =================
        const config = {
            username: 'tvgh',       // ä½ çš„ GitHub ç”¨æˆ·å
            repo: 'attachment',     // ä½ çš„ä»“åº“å
            branch: 'main',         // åˆ†æ”¯å
            rootPath: ''            // åˆå§‹æ ¹ç›®å½•ï¼Œå¦‚æœä½ æƒ³ä»æ ¹å¼€å§‹çœ‹ï¼Œç•™ç©º ''ï¼›å¦‚æœæƒ³ç›´æ¥çœ‹ piclistï¼Œå¡« 'piclist'
        };
        // ===========================================

        let currentPath = config.rootPath;
        const gallery = document.getElementById('gallery');
        const backBtn = document.getElementById('backBtn');
        const breadcrumb = document.getElementById('breadcrumb');

        // ä¸»å‡½æ•°ï¼šåŠ è½½æŒ‡å®šè·¯å¾„çš„å†…å®¹
        async function loadPath(path) {
            currentPath = path;
            updateUIState();
            
            gallery.innerHTML = '<div class="status-msg">æ­£åœ¨åŠ è½½...</div>';

            const apiUrl = `https://api.github.com/repos/${config.username}/${config.repo}/contents/${path}?ref=${config.branch}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    if(response.status === 403) throw new Error("API è®¿é—®é¢‘ç‡è¶…é™ï¼Œè¯·ç¨åå†è¯•");
                    if(response.status === 404) throw new Error("è·¯å¾„ä¸å­˜åœ¨æˆ–ä»“åº“æœªå…¬å¼€");
                    throw new Error(`é”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                renderContent(data);

            } catch (error) {
                gallery.innerHTML = `<div class="status-msg" style="color: #ff6b6b">${error.message}</div>`;
                console.error(error);
            }
        }

        // æ¸²æŸ“å†…å®¹ï¼ˆæ–‡ä»¶å¤¹ + å›¾ç‰‡ï¼‰
        function renderContent(data) {
            gallery.innerHTML = '';

            // 1. åˆ†ç¦»æ–‡ä»¶å¤¹å’Œæ–‡ä»¶
            const folders = data.filter(item => item.type === 'dir');
            const files = data.filter(item => item.type === 'file');

            // 2. è¿‡æ»¤å‡ºå›¾ç‰‡æ–‡ä»¶
            const images = files.filter(file => /\.(jpg|jpeg|png|gif|webp|svg|bmp)$/i.test(file.name));

            if (folders.length === 0 && images.length === 0) {
                gallery.innerHTML = '<div class="status-msg">æ­¤æ–‡ä»¶å¤¹ä¸ºç©º</div>';
                return;
            }

            // 3. æ¸²æŸ“æ–‡ä»¶å¤¹
            folders.forEach(folder => {
                const card = document.createElement('div');
                card.className = 'card folder-card';
                card.onclick = () => loadPath(folder.path); // ç‚¹å‡»è¿›å…¥æ–‡ä»¶å¤¹
                
                card.innerHTML = `
                    <div class="folder-icon">ğŸ“</div>
                    <div class="filename">${folder.name}</div>
                `;
                gallery.appendChild(card);
            });

            // 4. æ¸²æŸ“å›¾ç‰‡
            images.forEach(img => {
                // ä½¿ç”¨ jsDelivr CDN åŠ é€Ÿ
                // æ³¨æ„ï¼šjsDelivr çš„è·¯å¾„éœ€è¦å¯¹ path è¿›è¡Œç¼–ç å¤„ç†ï¼Œä½†é€šå¸¸ç®€å•è·¯å¾„ç›´æ¥æ‹¼æ¥å³å¯
                const cdnUrl = `https://cdn.jsdelivr.net/gh/${config.username}/${config.repo}@${config.branch}/${img.path}`;
                
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => window.open(cdnUrl, '_blank'); // ç‚¹å‡»æŸ¥çœ‹å¤§å›¾

                card.innerHTML = `
                    <div class="img-container">
                        <img src="${cdnUrl}" loading="lazy" alt="${img.name}">
                    </div>
                    <div class="filename" title="${img.name}">${img.name}</div>
                `;
                gallery.appendChild(card);
            });
        }

        // æ›´æ–°å¯¼èˆªæ çŠ¶æ€
        function updateUIState() {
            // æ›´æ–°é¢åŒ…å±‘
            breadcrumb.innerHTML = `å½“å‰è·¯å¾„: <span>${currentPath === '' ? 'æ ¹ç›®å½•' : currentPath}</span>`;
            
            // æ›´æ–°è¿”å›æŒ‰é’®çŠ¶æ€
            if (currentPath === '' || currentPath === config.rootPath) {
                backBtn.disabled = true;
            } else {
                backBtn.disabled = false;
            }
        }

        // è¿”å›ä¸Šä¸€çº§é€»è¾‘
        function goBack() {
            if (currentPath === '' || currentPath === config.rootPath) return;

            // ç§»é™¤è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†
            // ä¾‹å¦‚: "piclist/2023/01" -> split -> ["piclist", "2023", "01"] -> slice -> ["piclist", "2023"] -> join -> "piclist/2023"
            const parts = currentPath.split('/');
            parts.pop(); 
            const parentPath = parts.join('/');
            
            loadPath(parentPath);
        }

        // åˆå§‹åŠ è½½
        loadPath(config.rootPath);

    </script>
</body>
</html>
